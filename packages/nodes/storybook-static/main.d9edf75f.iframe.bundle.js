(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{1036:function(module,exports,__webpack_require__){"use strict";(function(module){(0,__webpack_require__(391).configure)([__webpack_require__(1037),__webpack_require__(1038)],module,!1)}).call(this,__webpack_require__(203)(module))},1037:function(module,exports){function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,module.exports=webpackEmptyContext,webpackEmptyContext.id=1037},1038:function(module,exports,__webpack_require__){var map={"./composite/stories/Composite.stories.tsx":1047};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=1038},1047:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Example",(function(){return Example}));var constants_namespaceObject={};__webpack_require__.r(constants_namespaceObject),__webpack_require__.d(constants_namespaceObject,"DnD_Node",(function(){return DnD_Node})),__webpack_require__.d(constants_namespaceObject,"getNodeEditComponent",(function(){return constants_getNodeEditComponent})),__webpack_require__.d(constants_namespaceObject,"getPorts",(function(){return getPorts})),__webpack_require__.d(constants_namespaceObject,"getPortType",(function(){return getPortType})),__webpack_require__.d(constants_namespaceObject,"getNodeType",(function(){return getNodeType}));var composite_namespaceObject={};__webpack_require__.r(composite_namespaceObject),__webpack_require__.d(composite_namespaceObject,"getNodeEditComponent",(function(){return getNodeEditComponent_getNodeEditComponent})),__webpack_require__.d(composite_namespaceObject,"nodeFunction",(function(){return nodeFunction_nodeFunction})),__webpack_require__.d(composite_namespaceObject,"getPorts",(function(){return getPorts_getPorts}));__webpack_require__(46),__webpack_require__(8),__webpack_require__(7),__webpack_require__(13);var ModuleType,react=__webpack_require__(0);__webpack_require__(155),__webpack_require__(16),__webpack_require__(12),__webpack_require__(15),__webpack_require__(76),__webpack_require__(1039),__webpack_require__(194),__webpack_require__(28),__webpack_require__(300),__webpack_require__(14),__webpack_require__(25),__webpack_require__(106),__webpack_require__(1040),__webpack_require__(1042),__webpack_require__(22),__webpack_require__(468),__webpack_require__(276),__webpack_require__(476),__webpack_require__(41),__webpack_require__(45),__webpack_require__(59),__webpack_require__(114),__webpack_require__(26),__webpack_require__(1043),__webpack_require__(6),__webpack_require__(9),__webpack_require__(18);function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}!function(ModuleType){ModuleType[ModuleType.ESM=0]="ESM",ModuleType[ModuleType.SYSTEM=1]="SYSTEM",ModuleType[ModuleType.CUSTOM=2]="CUSTOM"}(ModuleType||(ModuleType={}));var isModule=function isModule(module){return void 0!==module.esm||void 0!==module.system||void 0!==module.import},toCustomModule=function toCustomModule(module){if(void 0!==module.import)return module},Loader=function(){function Loader(importer){_classCallCheck(this,Loader),this.importer=importer}var _importModule;return _createClass(Loader,[{key:"importModule",value:(_importModule=_asyncToGenerator(regeneratorRuntime.mark((function _callee(module,version,baseUrl){var customModule;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!(customModule=toCustomModule(module))||!customModule.import){_context.next=3;break}return _context.abrupt("return",customModule.import());case 3:if(null!=this.importer){_context.next=5;break}throw new Error("importer not defined");case 5:return _context.abrupt("return",this.importer(module,version,baseUrl));case 6:case"end":return _context.stop()}}),_callee,this)}))),function importModule(_x,_x2,_x3){return _importModule.apply(this,arguments)})}],[{key:"SystemImportWrapper",value:function SystemImportWrapper(importer){return function(module,version,baseUrl){var resolvedModuleBaseUrl,systemModule=module;systemModule.base&&(resolvedModuleBaseUrl=new URL(systemModule.base.toString(),baseUrl));var resolvedUrl=new URL(systemModule.system.toString(),resolvedModuleBaseUrl);return resolvedUrl.search="version="+version,importer(resolvedUrl.toString())}}},{key:"ESMImportWrapper",value:function ESMImportWrapper(importer){return function(module,version,baseUrl){var resolvedModuleBaseUrl,esmModule=module;esmModule.base&&(resolvedModuleBaseUrl=new URL(esmModule.base.toString(),baseUrl));var resolvedUrl=new URL(esmModule.esm.toString(),resolvedModuleBaseUrl);return resolvedUrl.search="version="+version,importer(resolvedUrl.toString())}}}]),Loader}(),nullLogMethod=function nullLogMethod(){return nullLogger},nullLogger={error:nullLogMethod,warn:nullLogMethod,info:nullLogMethod,debug:nullLogMethod,child:function child(){return nullLogger}},TreeMap=function(){function TreeMap(){_classCallCheck(this,TreeMap),this.rootNode={},this.rootNode={}}return _createClass(TreeMap,[{key:"setNodeValue",value:function setNodeValue(node){for(var _len=arguments.length,path=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)path[_key-1]=arguments[_key];this.checkPath(path);var nodeAtPath=this.getNodeFromPath(this.rootNode,!0,path);nodeAtPath&&(nodeAtPath.value=node)}},{key:"getNodeValue",value:function getNodeValue(){for(var _len2=arguments.length,path=new Array(_len2),_key2=0;_key2<_len2;_key2++)path[_key2]=arguments[_key2];this.checkPath(path);var nodeAtPath=this.getNodeFromPath(this.rootNode,!1,path);if(nodeAtPath)return nodeAtPath.value}},{key:"deleteNode",value:function deleteNode(){for(var _len3=arguments.length,path=new Array(_len3),_key3=0;_key3<_len3;_key3++)path[_key3]=arguments[_key3];this.checkPath(path),1===path.length&&delete this.rootNode[path[0]];var parentNode=this.getNodeFromPath(this.rootNode,!1,path.slice(0,-1));parentNode&&parentNode.tmap&&delete parentNode.tmap[path[path.length-1]]}},{key:"getFromPath",value:function getFromPath(recursive){for(var _len4=arguments.length,path=new Array(_len4>1?_len4-1:0),_key4=1;_key4<_len4;_key4++)path[_key4-1]=arguments[_key4];this.checkPath(path);var nodeAtPath=this.getNodeFromPath(this.rootNode,!1,path);return nodeAtPath?recursive?this.getNodeValuesRecursive(nodeAtPath)||[]:nodeAtPath.tmap?Object.values(nodeAtPath.tmap).map((function(n){return n.value}))||[]:[nodeAtPath.value]:[]}},{key:"getAll",value:function getAll(){var _this=this;return Object.values(this.rootNode).flatMap((function(cn){return _this.getNodeValuesRecursive(cn)}))||[]}},{key:"clear",value:function clear(){return this.rootNode={}}},{key:"toJson",value:function toJson(){return JSON.stringify(this.rootNode,null," ")}},{key:"checkPath",value:function checkPath(path){if(null==path||0===path.length)throw new Error("path[s] not valid")}},{key:"getNodeValuesRecursive",value:function getNodeValuesRecursive(nodeValue){var _this2=this;if(nodeValue.tmap){var childNodes=Object.values(nodeValue.tmap);return nodeValue.value?[nodeValue.value].concat(_toConsumableArray(childNodes.flatMap((function(cn){return _this2.getNodeValuesRecursive(cn)})))):childNodes.flatMap((function(cn){return _this2.getNodeValuesRecursive(cn)}))}return nodeValue.value?[nodeValue.value]:[]}},{key:"getNodeFromPath",value:function getNodeFromPath(rootNode,createIfNotExists,path){for(var currentNode=rootNode,i=0;i<path.length;i++){var tempNode=currentNode[path[i]];if(createIfNotExists&&null==tempNode&&(tempNode=Object.create(null),currentNode[path[i]]=tempNode),createIfNotExists&&null==tempNode.tmap&&i<path.length-1&&(tempNode.tmap=Object.create(null)),null==tempNode)return;if(i===path.length-1)currentNode=tempNode;else{if(!tempNode.tmap)return;currentNode=tempNode.tmap}}return currentNode}}]),TreeMap}(),TypeRepo=function(){function TypeRepo(loader,onConstruct){_classCallCheck(this,TypeRepo),this.loader=loader,this.typeMap=new TreeMap,null==onConstruct||onConstruct.call(this)}var _getExport,_getExportFunction;return _createClass(TypeRepo,[{key:"load",value:function load(types,baseUrl){this.baseUrl=baseUrl,this.typeMap.clear();var _step,_iterator=_createForOfIteratorHelper(types);try{for(_iterator.s();!(_step=_iterator.n()).done;){var type=_step.value;this.typeMap.setNodeValue(type,type.scope||"root",type.name)}}catch(err){_iterator.e(err)}finally{_iterator.f()}}},{key:"getExportFunction",value:(_getExportFunction=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(scope,typeName,functionName){var type,moduleFunction;return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(null!=(type=this.typeMap.getNodeValue(scope,typeName))){_context2.next=3;break}return _context2.abrupt("return");case 3:return _context2.next=5,this.getExport(type,functionName);case 5:if("function"==typeof(moduleFunction=_context2.sent)){_context2.next=8;break}throw new Error("export '"+functionName+"' from type '"+typeName+"' not a function");case 8:return _context2.abrupt("return",moduleFunction);case 9:case"end":return _context2.stop()}}),_callee2,this)}))),function getExportFunction(_x4,_x5,_x6){return _getExportFunction.apply(this,arguments)})},{key:"getExport",value:(_getExport=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(type,name){var _type$exportMap,moduleInfo,exportName,redirect,module;return regeneratorRuntime.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return moduleInfo=type.module,exportName=name,(redirect=null===(_type$exportMap=type.exportMap)||void 0===_type$exportMap?void 0:_type$exportMap[name])&&("string"==typeof redirect?exportName=redirect:redirect.name&&isModule(redirect)?(exportName=redirect.name,moduleInfo=redirect):isModule(redirect)&&(moduleInfo=redirect)),_context3.next=6,this.loader.importModule(moduleInfo,type.version,this.baseUrl);case 6:if(module=_context3.sent,!moduleInfo.nameSpace){_context3.next=11;break}return _context3.abrupt("return",module[moduleInfo.nameSpace][exportName]);case 11:return _context3.abrupt("return",module[exportName]);case 12:case"end":return _context3.stop()}}),_callee3,this)}))),function getExport(_x7,_x8){return _getExport.apply(this,arguments)})},{key:"getTypes",value:function getTypes(scopeId){return this.typeMap.getFromPath(!1,scopeId)}},{key:"getAllTypes",value:function getAllTypes(){return this.typeMap.getAll()}},{key:"getType",value:function getType(scopeId,typeName){var type=this.typeMap.getNodeValue(scopeId,typeName);if(null==type)throw new Error("type with name: '"+typeName+"', not found on scope: '"+scopeId+"'");return type}},{key:"hasType",value:function hasType(scopeId,typeName){return null!=this.typeMap.getNodeValue(scopeId,typeName)}},{key:"deleteType",value:function deleteType(scopeId,typeName){return this.typeMap.deleteNode(scopeId,typeName)}},{key:"addType",value:function addType(scopeId,type){type.scope=scopeId||"root",this.typeMap.setNodeValue(type,type.scope,type.name)}}]),TypeRepo}(),NodeRepo=function(){function NodeRepo(onConstruct){_classCallCheck(this,NodeRepo),this.nodeIndex=new Map,this.nodeTreeMap=new TreeMap,null==onConstruct||onConstruct.call(this)}return _createClass(NodeRepo,[{key:"load",value:function load(nodes){var _this3=this;this.nodeTreeMap.clear(),this.nodeIndex.clear(),nodes.forEach((function(node){_this3.nodeIndex.set(node.id,node),_this3.nodeTreeMap.setNodeValue(node,node.scope||"root",node.id)}))}},{key:"getNode",value:function getNode(scopeId,id){return this.nodeTreeMap.getNodeValue(scopeId,id)}},{key:"getTypeNameFromNodeId",value:function getTypeNameFromNodeId(scopeId,id){var _this$nodeTreeMap$get;return null===(_this$nodeTreeMap$get=this.nodeTreeMap.getNodeValue(scopeId,id))||void 0===_this$nodeTreeMap$get?void 0:_this$nodeTreeMap$get.type}},{key:"getNodesByType",value:function getNodesByType(scopeId,typeName){return this.nodeTreeMap.getFromPath(!1,scopeId).filter((function(n){return n.type===typeName}))}},{key:"getNodes",value:function getNodes(scopeId){return this.nodeTreeMap.getFromPath(!1,scopeId)}},{key:"getAllNodes",value:function getAllNodes(){return this.nodeTreeMap.getAll()}},{key:"getUsedTypes",value:function getUsedTypes(scopeId){var usedTypes=this.nodeTreeMap.getFromPath(!1,scopeId).reduce((function(acc,node){return acc.add(node.type),acc}),new Set);return Array.from(usedTypes.keys())}},{key:"getAllUsedTypes",value:function getAllUsedTypes(){var usedTypes=this.nodeTreeMap.getAll().reduce((function(acc,node){return acc.add(node.type),acc}),new Set);return Array.from(usedTypes.keys())}},{key:"upsertNode",value:function upsertNode(scopeId,node){if(null==node.type)throw new Error("node requires typeName to be defined");if(null==node.id){var newId;do{newId=generateId()}while(this.nodeIndex.get(newId));var nodeCpy=Object.assign({},node,{type:node.type,id:newId,scope:scopeId});return this.nodeTreeMap.setNodeValue(nodeCpy,scopeId,nodeCpy.id),this.nodeIndex.set(nodeCpy.id,nodeCpy),nodeCpy}var existingNode=this.nodeTreeMap.getNodeValue(scopeId,node.id);if(null==existingNode)throw new Error("node with id: '"+node.id+"' does not exist");var updatedNode=Object.assign({},existingNode,node,{scope:scopeId});return this.nodeTreeMap.setNodeValue(updatedNode,scopeId,node.id),this.nodeIndex.set(node.id,updatedNode),updatedNode}},{key:"deleteNode",value:function deleteNode(scopeId,id){this.nodeIndex.delete(id),this.nodeTreeMap.deleteNode(scopeId,id)}}]),NodeRepo}(),generateId=function generateId(length){for(var alphanumeric="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",len=null!=length?length:10,result="",i=0;i<len;++i)result+=alphanumeric[Math.floor(Math.random()*alphanumeric.length)];return result},LinkRepo=function(){function LinkRepo(onConstruct){_classCallCheck(this,LinkRepo),this.updateSourceMap=!1,null==onConstruct||onConstruct.call(this),this.targetMap=new TreeMap,this.sourceMap=new TreeMap}return _createClass(LinkRepo,[{key:"load",value:function load(links){this.targetMap.clear(),this.sourceMap.clear();var _step2,_iterator2=_createForOfIteratorHelper(links);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var link=_step2.value;this.addToTargetMap(link)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}this.updateSourceMap=!0}},{key:"getPortLinks",value:function getPortLinks(scopeId,port,target){return this.targetMap.getFromPath(!1,scopeId,port,target)}},{key:"getSourceLinks",value:function getSourceLinks(scopeId,source){if(this.updateSourceMap){this.sourceMap.clear();var _step3,_iterator3=_createForOfIteratorHelper(this.targetMap.getAll());try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var link=_step3.value;this.addToSourceMap(link)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return this.sourceMap.getFromPath(!0,scopeId,source)}},{key:"addLink",value:function addLink(newLink){this.addToTargetMap(newLink),this.updateSourceMap=!0}},{key:"getLinks",value:function getLinks(scopeId){return this.targetMap.getFromPath(!0,scopeId)}},{key:"getAllLinks",value:function getAllLinks(){return this.targetMap.getAll()}},{key:"deleteLink",value:function deleteLink(link){this.targetMap.deleteNode(link.scope||"root",link.port,link.target,link.source),this.updateSourceMap=!0}},{key:"addToTargetMap",value:function addToTargetMap(link){var scope=link.scope||"root";this.targetMap.setNodeValue(link,scope,link.port,link.target,link.source)}},{key:"addToSourceMap",value:function addToSourceMap(link){var scope=link.scope||"root";this.sourceMap.setNodeValue(link,scope,link.source,link.target,link.port)}}]),LinkRepo}(),GraphApi=function(){function GraphApi(nodesApi,typesApi,linksApi){_classCallCheck(this,GraphApi),this.nodesApi=nodesApi,this.typesApi=typesApi,this.linksApi=linksApi}return _createClass(GraphApi,[{key:"setGraph",value:function setGraph(graph,baseUrl){this.typesApi.load(graph.types,baseUrl),this.nodesApi.load(graph.nodes),this.linksApi.load(graph.links),this.graph=graph}},{key:"getGraph",value:function getGraph(){var types=this.typesApi.getAllTypes().filter((function(t){return null==t.volatile||!1===t.volatile})),nodes=this.nodesApi.getAllNodes(),links=this.linksApi.getAllLinks();return Object.assign({},this.graph,{types:types,nodes:nodes,links:links})}}]),GraphApi}(),TypesApi=function(){function TypesApi(scopeId,typeRepo,parentTypes){_classCallCheck(this,TypesApi),this.scopeId=scopeId,this.typeRepo=typeRepo,this.parentTypes=parentTypes}var _getExport2,_getExportFunction2;return _createClass(TypesApi,[{key:"load",value:function load(types,baseUrl){this.typeRepo.load(types,baseUrl)}},{key:"getExportFunction",value:(_getExportFunction2=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(typeName,functionName){var func;return regeneratorRuntime.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,this.typeRepo.getExportFunction(this.scopeId,typeName,functionName);case 2:if(!(func=_context4.sent)){_context4.next=5;break}return _context4.abrupt("return",func);case 5:if(!this.parentTypes){_context4.next=7;break}return _context4.abrupt("return",this.parentTypes.getExportFunction(typeName,functionName));case 7:case"end":return _context4.stop()}}),_callee4,this)}))),function getExportFunction(_x9,_x10){return _getExportFunction2.apply(this,arguments)})},{key:"getExport",value:(_getExport2=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(type,name){var typeExport;return regeneratorRuntime.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this.typeRepo.getExport(type,name);case 2:if(!(typeExport=_context5.sent)){_context5.next=5;break}return _context5.abrupt("return",typeExport);case 5:case"end":return _context5.stop()}}),_callee5,this)}))),function getExport(_x11,_x12){return _getExport2.apply(this,arguments)})},{key:"getTypes",value:function getTypes(){var scopeTypes=this.typeRepo.getTypes(this.scopeId);if(this.parentTypes){var parentTypes=this.parentTypes.getTypes();return _toConsumableArray(new Set([].concat(_toConsumableArray(parentTypes),_toConsumableArray(scopeTypes))))}return scopeTypes}},{key:"getAllTypes",value:function getAllTypes(){return this.typeRepo.getAllTypes()}},{key:"getType",value:function getType(typeName){var type=this.typeRepo.getType(this.scopeId,typeName);return type||(this.parentTypes?this.parentTypes.getType(typeName):void 0)}},{key:"hasType",value:function hasType(typeName){return!!this.typeRepo.hasType(this.scopeId,typeName)||!!this.parentTypes&&this.parentTypes.hasType(typeName)}},{key:"addType",value:function addType(type){this.typeRepo.addType(this.scopeId,type)}}]),TypesApi}(),NodesApi=function(){function NodesApi(scopeId,nodeRepo,typesApi,linksApi,parentNodes){_classCallCheck(this,NodesApi),this.scopeId=scopeId,this.nodeRepo=nodeRepo,this.typesApi=typesApi,this.linksApi=linksApi,this.parentNodes=parentNodes}return _createClass(NodesApi,[{key:"load",value:function load(nodes){this.nodeRepo.load(nodes)}},{key:"getNode",value:function getNode(id){var node=this.nodeRepo.getNode(this.scopeId,id);return node||(this.parentNodes?this.parentNodes.getNode(id):void 0)}},{key:"getTypeNameFromNodeId",value:function getTypeNameFromNodeId(id){var typeName=this.nodeRepo.getTypeNameFromNodeId(this.scopeId,id);return typeName||(this.parentNodes?this.parentNodes.getTypeNameFromNodeId(id):void 0)}},{key:"getNodesByType",value:function getNodesByType(typeName){var scopeNodes=this.nodeRepo.getNodesByType(this.scopeId,typeName);if(this.parentNodes){var parentNodes=this.parentNodes.getNodesByType(typeName);return[].concat(_toConsumableArray(parentNodes),_toConsumableArray(scopeNodes))}return scopeNodes}},{key:"getNodes",value:function getNodes(){var scopeNodes=this.nodeRepo.getNodes(this.scopeId);if(this.parentNodes){var parentNodes=this.parentNodes.getNodes();return[].concat(_toConsumableArray(parentNodes),_toConsumableArray(scopeNodes))}return scopeNodes}},{key:"getAllNodes",value:function getAllNodes(){return this.nodeRepo.getAllNodes()}},{key:"getUsedTypes",value:function getUsedTypes(){var scopeTypes=this.nodeRepo.getUsedTypes(this.scopeId);if(this.parentNodes){var parentTypes=this.parentNodes.getUsedTypes();return _toConsumableArray(new Set([].concat(_toConsumableArray(parentTypes),_toConsumableArray(scopeTypes))))}return scopeTypes}},{key:"upsertNode",value:function upsertNode(node,type){var nodeType;if(type){!1===this.typesApi.hasType(type.name)&&this.typesApi.addType(type),nodeType=type}else{if(!node.type)throw new Error("either type or node.type must be provided");var _type=this.typesApi.getType(node.type);if(null==_type)throw new Error("type with name: '"+node.type+"' not found");nodeType=_type}return this.nodeRepo.upsertNode(this.scopeId,Object.assign({},node,{type:nodeType.name}))}},{key:"copyNode",value:function copyNode(node){var nodeCopy=JSON.parse(JSON.stringify(node));return delete nodeCopy.id,nodeCopy.scope=this.scopeId,this.upsertNode(nodeCopy)}},{key:"deleteNode",value:function deleteNode(nodeId){if(null==this.nodeRepo.getTypeNameFromNodeId(this.scopeId,nodeId))throw new Error("type name for node with id: '"+nodeId+"', not found");var sourceLinks=this.linksApi.getAllLinks().filter((function(l){return l.source===nodeId}));if(sourceLinks&&sourceLinks.length>0)throw new Error("node with id: '"+nodeId+"' is a source and cannot be deleted");this.nodeRepo.deleteNode(this.scopeId,nodeId)}}]),NodesApi}(),LinksApi=function(){function LinksApi(scopeId,linkRepo){_classCallCheck(this,LinksApi),this.scopeId=scopeId,this.linkRepo=linkRepo}return _createClass(LinksApi,[{key:"load",value:function load(links){this.linkRepo.load(links)}},{key:"getPortLinks",value:function getPortLinks(port,target){return this.linkRepo.getPortLinks(this.scopeId,port,target)}},{key:"getSourceLinks",value:function getSourceLinks(source){return this.linkRepo.getSourceLinks(this.scopeId,source)}},{key:"addLink",value:function addLink(newLink){return this.linkRepo.addLink(newLink)}},{key:"getLinks",value:function getLinks(){return this.linkRepo.getLinks(this.scopeId)}},{key:"getAllLinks",value:function getAllLinks(){return this.linkRepo.getAllLinks()}},{key:"deleteLink",value:function deleteLink(link){return this.linkRepo.deleteLink(link)}}]),LinksApi}(),FlowEngine=function(){function FlowEngine(medley,cache){var _this4=this;_classCallCheck(this,FlowEngine),this.medley=medley,this.runNodeFunction=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee7(context,nodeId){var flowEngine,getNodeFunction,nodeFunction,_len5,args,_key5,_args7=arguments;return regeneratorRuntime.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return flowEngine=_this4,getNodeFunction=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee6(context){var nodeFuction;return regeneratorRuntime.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,FlowEngine.buildNodeFunction(context,flowEngine,nodeId);case 2:return nodeFuction=_context6.sent,_context6.abrupt("return",nodeFuction);case 4:case"end":return _context6.stop()}}),_callee6)})));return function getNodeFunction(_x15){return _ref2.apply(this,arguments)}}(),_context7.next=4,getNodeFunction(context);case 4:for(nodeFunction=_context7.sent,_len5=_args7.length,args=new Array(_len5>2?_len5-2:0),_key5=2;_key5<_len5;_key5++)args[_key5-2]=_args7[_key5];return _context7.abrupt("return",nodeFunction.apply(void 0,args));case 7:case"end":return _context7.stop()}}),_callee7)})));return function(_x13,_x14){return _ref.apply(this,arguments)}}(),this.resultCache=cache||new Map}var _buildNodeFunction;return _createClass(FlowEngine,[{key:"createContext",value:function createContext(parentContext,medley,node){var logger=medley.logger.child({typeName:node.type,nodeId:node.id});return Object.assign({},parentContext,{medley:medley,node:node,logger:logger})}},{key:"buildPortInputFunction",value:function buildPortInputFunction(node,context,runNodeFunction){var flowEngine=this;return function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee8(port){var _len6,args,_key6,links,isSingle,executionContext,link,cacheItem,result,_cacheItem,results,validResults,_args8=arguments;return regeneratorRuntime.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:for(_len6=_args8.length,args=new Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++)args[_key6-1]=_args8[_key6];if(null!=(links=flowEngine.medley.links.getPortLinks(port.name,node.id))&&0!==links.length){_context8.next=4;break}return _context8.abrupt("return");case 4:if(!(isSingle=null==port.multiArity||!1===port.multiArity)||1===links.length){_context8.next=7;break}throw new Error("multiple links detected for port: '"+port.name+"'");case 7:if(executionContext=port.context?Object.assign({},port.context,context):context,!isSingle){_context8.next=18;break}if(link=links[0],!(cacheItem=flowEngine.checkCache(node.id,args))||!cacheItem.result){_context8.next=13;break}return _context8.abrupt("return",cacheItem.result);case 13:return result=runNodeFunction(executionContext,link.source,args),cacheItem&&cacheItem.addToCache&&cacheItem.key&&flowEngine.addToCache(cacheItem.key,result),_context8.abrupt("return",result);case 18:if(!(_cacheItem=flowEngine.checkCache(node.id,args))||!_cacheItem.result){_context8.next=21;break}return _context8.abrupt("return",_cacheItem.result);case 21:return _context8.next=23,Promise.all(links.map((function(l){return runNodeFunction(executionContext,l.source,args)})));case 23:if(!(results=_context8.sent)){_context8.next=28;break}return validResults=results.filter((function(e){return void 0!==e})),_cacheItem&&_cacheItem.addToCache&&_cacheItem.key&&flowEngine.addToCache(_cacheItem.key,validResults),_context8.abrupt("return",validResults);case 28:case"end":return _context8.stop()}}),_callee8)})));return function portInputFunction(_x16){return _ref3.apply(this,arguments)}}()}},{key:"checkCache",value:function checkCache(sourceId){var node=this.medley.nodes.getNode(sourceId);if(null==node||null==node.cache||!1===node.cache)return null;for(var _len7=arguments.length,args=new Array(_len7>1?_len7-1:0),_key7=1;_key7<_len7;_key7++)args[_key7-1]=arguments[_key7];var key=""+node.id+JSON.stringify(args);return this.resultCache.has(key)?{addToCache:!1,result:this.resultCache.get(key)}:{addToCache:!0,key:key}}},{key:"addToCache",value:function addToCache(key,result){this.resultCache.set(key,result)}}],[{key:"buildNodeFunction",value:(_buildNodeFunction=_asyncToGenerator(regeneratorRuntime.mark((function _callee10(context,flowEngine,nodeId){var runNodeFunction,node,nodeFunction,childContext,portInput;return regeneratorRuntime.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:if(runNodeFunction=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee9(parentContext,nodeId){var nodeFunction,_len8,args,_key8,_args9=arguments;return regeneratorRuntime.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,FlowEngine.buildNodeFunction(parentContext,flowEngine,nodeId);case 2:for(nodeFunction=_context9.sent,_len8=_args9.length,args=new Array(_len8>2?_len8-2:0),_key8=2;_key8<_len8;_key8++)args[_key8-2]=_args9[_key8];return _context9.abrupt("return",nodeFunction.apply(void 0,args));case 5:case"end":return _context9.stop()}}),_callee9)})));return function runNodeFunction(_x20,_x21){return _ref4.apply(this,arguments)}}(),null!=(node=flowEngine.medley.nodes.getNode(nodeId))){_context10.next=4;break}throw new Error("node with id: '"+nodeId+"', not found");case 4:return _context10.next=6,flowEngine.medley.types.getExportFunction(node.type,"nodeFunction");case 6:if(null!=(nodeFunction=_context10.sent)){_context10.next=9;break}throw new Error("node function for type: '"+node.type+"', not valid");case 9:return childContext=flowEngine.createContext(context,flowEngine.medley,node),portInput=flowEngine.buildPortInputFunction(node,childContext,runNodeFunction),childContext.input=portInput,_context10.abrupt("return",(function(){for(var _len9=arguments.length,args=new Array(_len9),_key9=0;_key9<_len9;_key9++)args[_key9]=arguments[_key9];return nodeFunction.apply(void 0,[childContext].concat(args))}));case 13:case"end":return _context10.stop()}}),_callee10)}))),function buildNodeFunction(_x17,_x18,_x19){return _buildNodeFunction.apply(this,arguments)})}]),FlowEngine}(),Medley=function(){function Medley(options,parentInstance){var _this$options$onConst;_classCallCheck(this,Medley),this.parentInstance=parentInstance,this.options=null==options?{linkRepo:new LinkRepo,typeRepo:new TypeRepo(new Loader),nodeRepo:new NodeRepo}:options;var scopeId=this.options.scopeId||"root";this.logger=this.options.logger||nullLogger,this.types=new TypesApi(scopeId,this.options.typeRepo,null==parentInstance?void 0:parentInstance.types),this.links=new LinksApi(scopeId,this.options.linkRepo),this.nodes=new NodesApi(scopeId,this.options.nodeRepo,this.types,this.links,null==parentInstance?void 0:parentInstance.nodes),this.graph=new GraphApi(this.nodes,this.types,this.links),this.flowEngine=new FlowEngine(this,this.options.cache),null===(_this$options$onConst=this.options.onConstruct)||void 0===_this$options$onConst||_this$options$onConst.call(this)}return _createClass(Medley,[{key:"runNode",value:function runNode(context,nodeId){for(var _this$flowEngine,_len10=arguments.length,args=new Array(_len10>2?_len10-2:0),_key10=2;_key10<_len10;_key10++)args[_key10-2]=arguments[_key10];return(_this$flowEngine=this.flowEngine).runNodeFunction.apply(_this$flowEngine,[context,nodeId].concat(args))}},{key:"getRootInstance",value:function getRootInstance(){return this.parentInstance?this.parentInstance.getRootInstance():this}}],[{key:"newChildInstance",value:function newChildInstance(parent,scopeId){if(null==scopeId||""===scopeId)throw new Error("scopeId not valid");return new Medley(Object.assign({},parent.options,{scopeId:scopeId}),parent)}}]),Medley}(),DnD_Node="NODE",constants_getNodeEditComponent="getNodeEditComponent",getPorts="getPorts",getPortType="getPortType",getNodeType="getNodeType",ReactFlow_esm=__webpack_require__(222),jsx_runtime=__webpack_require__(64),getNodeEditComponent_elements=[{id:"horizontal-1",sourcePosition:"right",type:"input",className:"dark-node",data:{label:"Input"},position:{x:0,y:80}},{id:"horizontal-2",sourcePosition:"right",targetPosition:"left",data:{label:"A Node"},position:{x:250,y:0}},{id:"horizontal-3",sourcePosition:"right",targetPosition:"left",data:{label:"Node 3"},position:{x:250,y:160}},{id:"horizontal-4",sourcePosition:"right",targetPosition:"left",data:{label:"Node 4"},position:{x:500,y:0}},{id:"horizontal-5",sourcePosition:"top",targetPosition:"bottom",data:{label:"Node 5"},position:{x:500,y:100}},{id:"horizontal-6",sourcePosition:"bottom",targetPosition:"top",data:{label:"Node 6"},position:{x:500,y:230}},{id:"horizontal-7",sourcePosition:"right",targetPosition:"left",data:{label:"Node 7"},position:{x:750,y:50}},{id:"horizontal-8",sourcePosition:"right",targetPosition:"left",data:{label:"Node 8"},position:{x:750,y:300}},{id:"horizontal-e1-2",source:"horizontal-1",type:"smoothstep",target:"horizontal-2",animated:!0},{id:"horizontal-e1-3",source:"horizontal-1",type:"smoothstep",target:"horizontal-3",animated:!0},{id:"horizontal-e1-4",source:"horizontal-2",type:"smoothstep",target:"horizontal-4",label:"edge label"},{id:"horizontal-e3-5",source:"horizontal-3",type:"smoothstep",target:"horizontal-5",animated:!0},{id:"horizontal-e3-6",source:"horizontal-3",type:"smoothstep",target:"horizontal-6",animated:!0},{id:"horizontal-e5-7",source:"horizontal-5",type:"smoothstep",target:"horizontal-7",animated:!0},{id:"horizontal-e6-8",source:"horizontal-6",type:"smoothstep",target:"horizontal-8",animated:!0}],getNodeEditComponent_CompositeNodeEditComponent=function CompositeNodeEditComponent(){return Object(jsx_runtime.jsx)("div",{style:{height:600},children:Object(jsx_runtime.jsxs)(ReactFlow_esm.c,{elements:getNodeEditComponent_elements,children:[Object(jsx_runtime.jsx)(ReactFlow_esm.b,{}),Object(jsx_runtime.jsx)(ReactFlow_esm.a,{})]})})};getNodeEditComponent_CompositeNodeEditComponent.displayName="CompositeNodeEditComponent";var getNodeEditComponent_getNodeEditComponent=function getNodeEditComponent(){return getNodeEditComponent_CompositeNodeEditComponent},nodeFunction_nodeFunction=function nodeFunction(cntx){var _node$value,node=cntx.node,medley=cntx.medley,input=cntx.input,childScope=Medley.newChildInstance(medley.getRootInstance(),node.id),inputType=function getInputType(input){var nodeFunction=function nodeFunction(_ref){var _node$value2,node=_ref.node;if(null!==(_node$value2=node.value)&&void 0!==_node$value2&&_node$value2.input)return input({name:node.value.input})};return{name:"$input",version:"",volatile:!0,module:{import:function _import(){return Promise.resolve({nodeFunction:nodeFunction})}}}}(input);childScope.types.addType(inputType);var outputType=function getOutputType(){var nodeFunction=function nodeFunction(_ref2){return(0,_ref2.input)({name:"output"})};return{name:"$output",version:"",volatile:!0,module:{import:function _import(){return Promise.resolve({nodeFunction:nodeFunction})}}}}();if(childScope.types.addType(outputType),null!==(_node$value=node.value)&&void 0!==_node$value&&_node$value.outputNode){var outputId=node.value.outputNode.id;return childScope.runNode(cntx,outputId)}};var getPorts_getPorts=function getPorts(_ref){var _node$value;return(null===(_node$value=_ref.node.value)||void 0===_node$value?void 0:_node$value.inputNodes)||[]},CompositeType={name:"composite",composite:!0,version:"1.0.0",module:{import:function _import(){return Promise.resolve(composite_namespaceObject)}}};function util_sb_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function util_sb_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){util_sb_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){util_sb_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function Composite_stories_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Composite_stories_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Composite_stories_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Composite_stories_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}__webpack_exports__.default={title:"Nodes/Composite"};var Example=function componentStory(componentFactory,containerFactory){var story=function story(args,_ref){var _ref$loaded=_ref.loaded,Component=_ref$loaded.Component,Container=_ref$loaded.Container;return Object(jsx_runtime.jsx)(react.Fragment,{children:null==Container?Object(jsx_runtime.jsx)(Component,Object.assign({},args)):Object(jsx_runtime.jsx)(Container,{children:Object(jsx_runtime.jsx)(Component,Object.assign({},args))})})};return story.loaders=[util_sb_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,componentFactory();case 2:if(_context.t0=_context.sent,_context.t1=containerFactory,!_context.t1){_context.next=8;break}return _context.next=7,containerFactory();case 7:_context.t1=_context.sent;case 8:return _context.t2=_context.t1,_context.abrupt("return",{Component:_context.t0,Container:_context.t2});case 10:case"end":return _context.stop()}}),_callee)})))],story}(Composite_stories_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var medley,getNodeEditComponent;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return(medley=new Medley).types.addType(CompositeType),_context.next=4,medley.types.getExportFunction(CompositeType.name,constants_namespaceObject.getNodeEditComponent);case 4:return getNodeEditComponent=_context.sent,_context.abrupt("return",null==getNodeEditComponent?void 0:getNodeEditComponent());case 6:case"end":return _context.stop()}}),_callee)}))),Composite_stories_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){return regeneratorRuntime.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",(function(_ref3){var children=_ref3.children;return Object(jsx_runtime.jsx)("div",{children:children})}));case 1:case"end":return _context2.stop()}}),_callee2)}))));Example.parameters=Object.assign({storySource:{source:"componentStory(async () => {\n  const medley = new Medley();\n  medley.types.addType(CompositeType);\n  const getNodeEditComponent = await medley.types.getExportFunction(\n    CompositeType.name,\n    constants.getNodeEditComponent\n  );\n  return getNodeEditComponent?.();\n}, async ()=>{return ({children})=><div>{children}</div>})"}},Example.parameters)},1055:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var preview_namespaceObject={};__webpack_require__.r(preview_namespaceObject),__webpack_require__.d(preview_namespaceObject,"parameters",(function(){return parameters}));__webpack_require__(23),__webpack_require__(6),__webpack_require__(45),__webpack_require__(467),__webpack_require__(476),__webpack_require__(41),__webpack_require__(1034),__webpack_require__(1035),__webpack_require__(300);var client_api=__webpack_require__(1062),esm=__webpack_require__(5),parameters={actions:{argTypesRegex:"^on[A-Z].*"},controls:{matchers:{color:/(background|color)$/i,date:/Date$/}}};function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.keys(preview_namespaceObject).forEach((function(key){var value=preview_namespaceObject[key];switch(key){case"args":case"argTypes":return esm.a.warn("Invalid args/argTypes in config, ignoring.",JSON.stringify(value));case"decorators":return value.forEach((function(decorator){return Object(client_api.c)(decorator,!1)}));case"loaders":return value.forEach((function(loader){return Object(client_api.d)(loader,!1)}));case"parameters":return Object(client_api.e)(function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({},value),!1);case"argTypesEnhancers":return value.forEach((function(enhancer){return Object(client_api.a)(enhancer)}));case"argsEnhancers":return value.forEach((function(enhancer){return Object(client_api.b)(enhancer)}));case"render":return Object(client_api.g)(value);case"globals":case"globalTypes":var v={};return v[key]=value,Object(client_api.e)(v,!1);default:return console.log(key+" was not supported :( !")}}))},522:function(module,exports,__webpack_require__){__webpack_require__(523),__webpack_require__(838),__webpack_require__(839),__webpack_require__(1045),__webpack_require__(1046),__webpack_require__(1052),__webpack_require__(1053),__webpack_require__(1051),__webpack_require__(1048),__webpack_require__(1054),__webpack_require__(1049),__webpack_require__(1050),__webpack_require__(1055),module.exports=__webpack_require__(1036)},606:function(module,exports){},648:function(module,exports){},694:function(module,exports){},717:function(module,exports){},780:function(module,exports){},839:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(391)}},[[522,2,3]]]);